<!DOCTYPE html>
<html>
<head>
  <title>Dieng Caldera Race 2024 - 75K Category</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet CSS & JS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- leaflet-gpx -->
  <script src="https://unpkg.com/leaflet-gpx@1.7.0/gpx.js"></script>

  <!-- leaflet-elevation -->
  <link rel="stylesheet" href="https://unpkg.com/@raruto/leaflet-elevation@2.5.1/dist/leaflet-elevation.min.css" />
  <script src="https://unpkg.com/@raruto/leaflet-elevation@2.5.1/dist/leaflet-elevation.min.js"></script>

  <style>
    body, html { margin:0; padding:0; height:100%; }
    #map { height:80vh; width:100%; }
    #elevation-div { height:20vh; }
  </style>
</head>
<body>

  <div id="map"></div>
  <div id="elevation-div"></div>

  <script>
    // --- Base layers ---
    var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap'
    });

    var esriSat = L.tileLayer(
      'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles &copy; Esri'
    });

    var opentopo = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
      attribution: 'Map data &copy; OpenTopoMap contributors'
    });

    // Inisialisasi peta
    var map = L.map('map', {
      center: [-7.2691, 109.9653],
      zoom: 10,
      layers: [osm]
    });

    // --- Elevation control ---
    var controlElevation = L.control.elevation({
      theme: "lightblue-theme",
      detached: true,
      elevationDiv: "#elevation-div",
      collapsed: false,
      summary: false,
      followMarker: true,
      imperial: false,
      legend: true
    });
    controlElevation.addTo(map);

    // --- GPX Track ---
    var gpxTrack = new L.GPX("revisi/75KM_DCR.gpx", {
      async: true,
      marker_options: {
        startIconUrl: 'https://leafletjs.com/examples/custom-icons/leaf-green.png',
        endIconUrl: 'https://leafletjs.com/examples/custom-icons/leaf-red.png',
        shadowUrl: ''
      }
    });

    gpxTrack.on("loaded", function(e) {
      map.fitBounds(e.target.getBounds());
    });

    gpxTrack.on("addline", function(e) {
      controlElevation.addData(e.line);
    });

    gpxTrack.addTo(map);

    // --- Custom WS Icon ---
    var wsIcon = L.icon({
      iconUrl: 'images/ws_pin.png',  // pastikan path benar
      iconSize: [40, 40],
      iconAnchor: [20, 40],
      popupAnchor: [0, -40]
    });

    // --- Tambahkan Water Stations ---
    L.marker([-7.27, 109.95], { icon: wsIcon }).addTo(map).bindPopup("<b>WS1</b><br/>Km 15");
    L.marker([-7.30, 110.00], { icon: wsIcon }).addTo(map).bindPopup("<b>WS2</b><br/>Km 30");
    L.marker([-7.33, 110.05], { icon: wsIcon }).addTo(map).bindPopup("<b>WS3</b><br/>Km 45");

    // --- Layer control ---
    var baseMaps = {
      "OpenStreetMap": osm,
      "Satelit (Esri)": esriSat,
      "OpenTopoMap": opentopo
    };

    var overlayMaps = {
      "Rute 75K": gpxTrack,
      "Water Stations": L.layerGroup([
        L.marker([-7.27, 109.95], { icon: wsIcon }).bindPopup("WS1 - Km 15"),
        L.marker([-7.30, 110.00], { icon: wsIcon }).bindPopup("WS2 - Km 30"),
        L.marker([-7.33, 110.05], { icon: wsIcon }).bindPopup("WS3 - Km 45")
      ])
    };

    L.control.layers(baseMaps, overlayMaps, { collapsed: false }).addTo(map);
  </script>

</body>
</html>
